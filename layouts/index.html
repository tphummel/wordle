{{ define "main" }}

<h1>{{ .Site.Title }}</h1>

<blockquote>
  ❗️⛔️ Note: You will not see puzzle solution spoilers anywhere on this site unless you opt in on an individual puzzle page by expanding the Guesses section.
</blockquote>

{{ $wordles := where .Site.RegularPages "Section" "w" }}
{{ $wins := where $wordles "Params.state.gameStatus" "WIN" }}
{{ $losses := where $wordles "Params.state.gameStatus" "FAIL"}}
{{ $nyt_puzzle_count := 2309 }}
{{ $nyt_valid_word_count := 10638 }}

<div>🧩 Puzzles Played: <strong><a href="{{ with .Site.GetPage "section" "w" }}{{ .RelPermalink }}{{ end }}">{{ len $wordles }}</a></strong></div>
<div>🧩 Win Pct: <strong>{{ lang.NumFmt 3 (div (float (len $wins)) (len $wordles)) }} ({{ len $wins }}-{{ len $losses }})</strong></div>
<div>🧩 Pct of Total Puzzles Played: <strong>{{ lang.NumFmt 2 (mul (div (float (len $wordles)) ($nyt_puzzle_count)) 100) }}% ({{ lang.NumFmt 0 (len $wordles) }}/{{ lang.NumFmt 0 $nyt_puzzle_count }})</strong></div>

{{ $total_guesses := 0}}
{{ range $wordles }}
  {{ $guesses := partial "guess-count" . }}
  {{ $guesses = cond (eq $guesses "X") 6 $guesses }}
  {{ $total_guesses = add $total_guesses $guesses }}
{{ end }}
<div>🧩 Total Guesses: <strong>{{ $total_guesses }}</strong></div>
<div>🧩 Guesses per Puzzle:  <strong>{{ lang.NumFmt 2 (div (float $total_guesses) (len $wordles)) }}</strong></div>
<div>🧩 Distinct Words Guessed: <strong><a href="{{ with .Site.GetPage "words" }}{{ .RelPermalink }}{{ end }}">{{ len .Site.Taxonomies.words }}</a></strong></div>
<div>🧩 Pct of Distinct Valid Words Guessed: <strong>{{ lang.NumFmt 2 (mul (div (float (len .Site.Taxonomies.words)) ($nyt_valid_word_count)) 100) }}% ({{ lang.NumFmt 0 (len .Site.Taxonomies.words) }}/{{ lang.NumFmt 0 ($nyt_valid_word_count) }})</strong></div>

<h2>🎯 Guess Distribution</h2>
<table>
  <tr>
    <td>Guesses</td>
    <td># of Puzzles</td>
    <td>Pct of Total</td>
  </tr>

{{ range $guesses := seq 1 6 }}
  {{ $puzzles := len (where $wins "Params.state.rowIndex" $guesses) }}
  <tr>
    <td>{{ $guesses }}</td>
    <td>{{ $puzzles }}</td>
    <td>{{ lang.NumFmt 2 (mul (div (float $puzzles) (len $wordles)) 100) }}%</td>
  </tr>
{{ end }}

<tr>
  <td>Loss</td>
  <td>{{ len $losses }} </td>
  <td>{{ lang.NumFmt 2 (mul (div (float (len $losses)) (len $wordles)) 100) }}%</td>
</tr>
</table>

<h2>🕰 Recent Puzzles</h2>
<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 $wordles }}
    <tr>
      <td><a href="{{ .RelPermalink }}">{{ .Title }}</a></td>
      <td>{{ .Date.Format "January 2, 2006" }}</td>
      <td>{{ partial "puzzle-score.html" . }}</td>
    </tr>

  {{ end }}
</table>

{{ range $wordles }}
  {{ $score := partial "puzzle-score" . }}
  {{ $.Scratch.Add "scored" (slice (dict "page" . "score" $score)) }}
{{ end }}

<h2>⬇️ Low (😄) Scores</h2>
<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "asc") }}
    <tr>
      <td><a href="{{ .page.RelPermalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<h2>⬆️ High (😖) Scores</h2>
<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "desc") }}
    <tr>
      <td><a href="{{ .page.RelPermalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<h2>⛳️ Opener Usage</h2>
<table>
  <tr>
    <td>Word</td>
    <td>Count</td>
  </tr>

  {{ $byFirst := dict }}
  {{ range $wordles }}
    {{ $score := partial "puzzle-score" . }}
    {{ $first := index .Params.state.boardState 0 }}
    {{ $date := .Date.Format "January 2, 2006" }}

    {{ if not (isset $byFirst $first) }}
      {{ $init := dict $first 0 }}
      {{ $byFirst = merge $byFirst $init }}
    {{ end }}

    {{ $prev := index $byFirst $first }}

    {{ $byFirst = merge $byFirst (dict $first (add 1 $prev)) }}
  {{ end }}

  {{ range $word, $count := $byFirst }}
    <tr>
      <td>{{ $word }}</td>
      <td>{{ $count }}</td>
    </tr>
  {{ end }}
</table>

<h2>🧰 Tools</h2>
<ul>
  <li><a href="/tools/">Bookmarklets</a></li>
</ul>

<h2>📒 Articles</h2>
<ul>
  <li>
  {{ with .Site.GetPage "a/savor.md" }}
    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
  {{ end }}
  </li>
</ul>

<h2>🏷 Tags</h2>
<ul>
{{range $name, $taxonomy := .Site.Taxonomies.tags}} {{ $cnt := .Count }}
  {{ with $.Site.GetPage (printf "/tags/%s" $name) }}
  <li>
    <a href={{ .RelPermalink }} title="All pages with tag {{$name}}">{{ $name }}</a>
    <sup>{{ $cnt }}</sup>
  </li>
  {{end}}
{{end}}
</ul>

<h2>✅ Rules / Data Tests</h2>
<ul>
{{ range (where .Site.RegularPages "Section" "r") }}
  <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
{{ end }}
</ul>


<a href="index.xml">RSS</a> | <a href="https://github.com/tphummel/wordle">GitHub</a>
{{ end }}
