{{ define "main" }}

<h1>{{ .Site.Title }}</h1>


<div>Total: {{ len .Site.RegularPages }} (W: {{ len (where .Site.RegularPages "Params.state.gameStatus" "WIN") }}, L: {{ len (where .Site.RegularPages "Params.state.gameStatus" "!=" "WIN") }}) </div>

<h2>Recent</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (.Site.RegularPages) }}
    <tr>
      <td><a href="{{ .Permalink }}">{{ .Title }}</a></td>
      <td>{{ .Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ partial "puzzle-score.html" . }}</td>
    </tr>

  {{ end }}
</table>

{{ range .Site.RegularPages }}
  {{ $score := partial "puzzle-score" . }}
  {{ $.Scratch.Add "scored" (slice (dict "page" . "score" $score)) }}
{{ end }}

<h2>Low Scores</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "asc") }}
    <tr>
      <td><a href="{{ .page.Permalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<h2>High Scores</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "desc") }}
    <tr>
      <td><a href="{{ .page.Permalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<a href="index.xml">rss</a>
{{ end }}
