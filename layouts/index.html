{{ define "main" }}

<h1>{{ .Site.Title }}</h1>


{{ $wordles := where .Site.RegularPages "Section" "w" }}
<div>Total: <a href="{{ with .Site.GetPage "section" "w" }}{{ .Permalink }}{{ end }}">{{ len $wordles }}</a> (W: {{ len (where $wordles "Params.state.gameStatus" "WIN") }}, L: {{ len (where $wordles "Params.state.gameStatus" "!=" "WIN") }}) </div>
<p><a href="{{ with .Site.GetPage "section" "w" }}{{ .Permalink }}{{ end }}">ðŸ§© All Puzzles</a></p>

<h2>Recent</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 $wordles }}
    <tr>
      <td><a href="{{ .Permalink }}">{{ .Title }}</a></td>
      <td>{{ .Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ partial "puzzle-score.html" . }}</td>
    </tr>

  {{ end }}
</table>

{{ range $wordles }}
  {{ $score := partial "puzzle-score" . }}
  {{ $.Scratch.Add "scored" (slice (dict "page" . "score" $score)) }}
{{ end }}

<h2>Low Scores</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "asc") }}
    <tr>
      <td><a href="{{ .page.Permalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<h2>High Scores</h2>

<table>
  <tr>
    <td>Puzzle</td>
    <td>Date</td>
    <td>Score</td>
  </tr>

  {{ range first 5 (sort ($.Scratch.Get "scored") ".score" "desc") }}
    <tr>
      <td><a href="{{ .page.Permalink }}">{{ .page.Title }}</a></td>
      <td>{{ .page.Date.Local.Format "January 2, 2006" }}</td>
      <td>{{ .score }}</td>
    </tr>
  {{ end }}
</table>

<h2>Openers</h2>

<table>
  <tr>
    <td>Word</td>
    <td>Count</td>
  </tr>

  {{ $byFirst := dict }}
  {{ range $wordles }}
    {{ $score := partial "puzzle-score" . }}
    {{ $first := index .Params.state.boardState 0 }}
    {{ $date := .Date.Local.Format "January 2, 2006" }}

    {{ if not (isset $byFirst $first) }}
      {{ $init := dict $first 0 }}
      {{ $byFirst = merge $byFirst $init }}
    {{ end }}

    {{ $prev := index $byFirst $first }}

    {{ $byFirst = merge $byFirst (dict $first (add 1 $prev)) }}
  {{ end }}

  {{ range $word, $count := $byFirst }}
    <tr>
      <td>{{ $word }}</td>
      <td>{{ $count }}</td>
    </tr>
  {{ end }}
</table>

<h2>Rules</h2>

<ul>
{{ range (where .Site.RegularPages "Section" "r") }}
  <li><a href="{{ .Permalink }}">{{ .Title }}</a></li>
{{ end }}
</ul>


<a href="index.xml">rss</a>
{{ end }}
